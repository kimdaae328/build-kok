<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.kok.mapper.FileMapper">
<!--    기업 회원 id로 프로필 사진 조회-->
    <select id="selectFileByCompanyId" parameterType="long" resultType="com.example.kok.dto.FileDTO">
        select c.user_id, f.id, f.file_origin_name, f.file_name, f.file_path, f.file_size, f.file_content_type, f.created_datetime, f.updated_datetime
        from tbl_company c
        join tbl_company_profile_file cp
        on c.user_id=cp.company_id
        join tbl_file f
        on cp.file_id = f.id
        where c.user_id=#{userId}
    </select>
    <insert id="insertFile" useGeneratedKeys="true" keyProperty="id">
    insert into tbl_file (file_origin_name, file_name, file_size, file_path, file_content_type)
    values (#{fileOriginName}, #{fileName}, #{fileSize}, #{filePath}, #{fileContentType})

    </insert>
<!--    file_name으로 id 조회-->
    <select id="selectFileByName">
        select id
        from tbl_file
        where file_name=#{fileName}
    </select>
    <!--  유저 아이디로 프로필 조회  -->
    <select id="selectProfileById">
        select f.file_path,f.id,f.file_origin_name,f.file_name,f.file_size,f.file_content_type
        from tbl_user u
                 join tbl_user_profile_file uf
                      on u.id = uf.user_id
                 join tbl_file f
                      on uf.file_id = f.id
        where u.id = #{id}  and u.user_status = 'active'
    </select>
</mapper>
