<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.kok.mapper.ConsoleExperienceDetailMapper">
    <select id="selectExperienceDatailByCompany">
        select en.id,
                en.experience_notice_title,
                en.experience_notice_subtitle,
                en.experience_start_date,
                en.experience_end_date,
                en.experience_notice_status,
                en.company_id,
                en.created_datetime,
                en.updated_datetime,
                jc.job_name as job_category_name
        from tbl_experience_notice en
            join tbl_experience_job_category ejc
                on en.id = ejc.experience_notice_id
            join tbl_job_category jc
                on ejc.job_category = jc.id
            left join tbl_request_experience re
                on en.id = re.experience_notice_id
            left join tbl_save_experience_notice sen
                on en.id = sen.experience_notice_id
        where en.id = #{experienceNoticeId}
        group by en.id, jc.job_name
    </select>

    <!-- 체험 상세 - 지원자 목록 조회 -->
    <select id="selectExperienceApplicantByCompany">
        select
            re.id as request_id,
            re.request_experience_status,
            re.created_datetime as request_datetime,
            u.id as user_id,
            u.user_name,
            u.user_email,
            u.user_phone,
            en.id as experience_notice_id,
            en.experience_notice_title,
            en.company_id
        from tbl_request_experience re
        join tbl_user u
            on re.member_id = u.id
        join tbl_experience_notice en
            on re.experience_notice_id = en.id
        where en.id = #{experienceNoticeId}
            and u.user_status = 'active'
        <if test="status != null">
            and re.request_experience_status = #{status}
        </if>
        order by re.id desc
        limit #{criteria.count} offset #{criteria.offset}
    </select>

    <select id="selectExperienceApplicantCountByCompany">
        select count(*)
        from tbl_request_experience re
        join tbl_user u
            on re.member_id = u.id
        join tbl_experience_notice en
            on re.experience_notice_id = en.id
        where en.id = #{experienceNoticeId}
        and u.user_status = 'active'
        <if test="status != null">
            and re.request_experience_status = #{status}
        </if>
    </select>
</mapper>