<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.kok.mapper.CommunityPostFileMapper">
<!-- 파일 추가 -->
    <insert id="insertFile" useGeneratedKeys="true" keyProperty="id">
        insert into tbl_file (file_origin_name, file_name, file_size, file_path, file_content_type)
        values (#{fileOriginName}, #{fileName}, #{fileSize}, #{filePath}, #{fileContentType})
    </insert>

<!-- 게시글 파일 작성 -->
    <insert id="insertPostFile">
        insert into tbl_post_file (file_id, post_id)
        values (#{fileId}, #{postId})
    </insert>

<!-- 게시글 파일 조회 -->
    <select id="selectPostFilesByPostId" resultType="com.example.kok.dto.PostFileDTO">
        select f.id as file_id, f.file_name as post_file_name, f.file_path as post_file_path,
               f.file_size as post_file_size, f.created_datetime, f.updated_datetime, pf.post_id
        from tbl_file f
                 join tbl_post_file pf on f.id = pf.file_id
        where pf.post_id = #{postId}
    </select>

<!-- 게시글 파일 경로 조회 -->
    <select id="selectPostFilePathByPostFileId" resultType="com.example.kok.dto.PostFileDTO">
        select f.id as file_id,
               f.file_path as post_file_path
        from tbl_file f
        join tbl_post_file pf on f.id = pf.file_id
        and f.id = #{fileId}
    </select>

<!-- 파일 조회 -->
    <select id="selectPostFileById">
        select f.id, f.file_name, f.file_path, f.file_size, f.created_datetime, f.updated_datetime, pf.post_id
        from tbl_file f
        join tbl_post_file pf on f.id = pf.file_id
        where f.id = #{id}
    </select>
<!-- 파일 삭제 -->
    <delete id="deletePostFile">
        delete from tbl_post_file
        where file_id = #{fileId}
    </delete>

    <delete id="deleteFile">
        delete from tbl_file
        where id = #{fileId}
    </delete>
</mapper>